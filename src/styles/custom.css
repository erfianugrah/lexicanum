/* Custom styles to improve layout and content display */

/*
 * Starlight Layout Architecture:
 * - Default content width: 45rem (too narrow for wide diagrams)
 * - Default sidebar width: 18.75rem
 * - Layout uses flexbox with calculated widths
 * - Main content: calc(--sl-content-width + (100% - --sl-content-width - --sl-sidebar-width) / 2)
 * - Right sidebar (ToC): calc(--sl-sidebar-width + (100% - --sl-content-width - --sl-sidebar-width) / 2)
 */

/* Base content width - applies to all screen sizes */
:root {
  --sl-content-width: 55rem; /* Increased from 45rem to 55rem for wider content */
}

/* Large screens (≥ 72rem / 1152px) - where ToC appears on the right */
@media (min-width: 72rem) {
  :root {
    --sl-content-width: 65rem; /* Even wider content on large screens */
  }

  /*
   * Optional: If you want to limit ToC width explicitly
   * The ToC will automatically shrink as content grows, but you can set a min-width
   */
  .right-sidebar-container {
    min-width: 15rem; /* Prevents ToC from getting too narrow */
    max-width: 20rem; /* Prevents ToC from getting too wide */
  }
}

/* Extra large screens (≥ 90rem / 1440px) - optimal for wide diagrams */
@media (min-width: 90rem) {
  :root {
    --sl-content-width: 75rem; /* Maximum content width for very large screens */
  }
}

/* Ensure code blocks don't overflow */
pre {
  max-width: 100%;
  overflow-x: auto;
  scroll-behavior: smooth;
}

/* ==========================================================================
   D2 Diagram Styling
   ========================================================================== */

/*
 * D2 generates SVGs with embedded styles that respond to prefers-color-scheme.
 * Starlight uses [data-theme] attributes for theme switching.
 * We need to ensure D2 diagrams respect Starlight's theme toggle.
 */

/* D2 diagram container styling */
img[src*="/d2/"] {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 1.5rem auto;
  border-radius: 0.5rem;
}

/* 
 * D2's inline SVGs already handle dark mode via @media (prefers-color-scheme: dark).
 * For users who override their system preference via Starlight's theme toggle,
 * we can't easily override the embedded SVG styles from external CSS.
 * 
 * Solution: Use CSS filters to invert colors when there's a theme mismatch.
 * This is a fallback for when the user manually toggles dark mode but their
 * system is in light mode (or vice versa).
 */

/* When Starlight is in dark mode but system prefers light */
@media (prefers-color-scheme: light) {
  [data-theme="dark"] img[src*="/d2/"] {
    filter: invert(0.88) hue-rotate(180deg);
  }
}

/* When Starlight is in light mode but system prefers dark */
@media (prefers-color-scheme: dark) {
  [data-theme="light"] img[src*="/d2/"] {
    filter: invert(0.88) hue-rotate(180deg);
  }
}
